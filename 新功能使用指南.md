# ğŸ‰ æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

> **ç‰ˆæœ¬ï¼š** v2.1  
> **æ–°å¢åŠŸèƒ½ï¼š** å•é—¨åº—+å¤šäº§å“ã€é¦™æ¸¯é—¨åº—æ”¯æŒ  
> **æ›´æ–°æ—¶é—´ï¼š** 2025-10-06

---

## âœ¨ æ–°åŠŸèƒ½æ¦‚è¿°

### åŠŸèƒ½1ï¼šå•é—¨åº—+å¤šäº§å“æ”¯æŒ

**åŠŸèƒ½è¯´æ˜ï¼š**
- ç›‘æ§å•ä¸ªé—¨åº—çš„å¤šä¸ªäº§å“å‹å·
- æ›´ä½çš„è¯·æ±‚é¢‘ç‡
- æ›´ç¬¦åˆå®é™…ä½¿ç”¨åœºæ™¯

**é€‚ç”¨åœºæ™¯ï¼š**
- åªå…³å¿ƒå®¶é™„è¿‘/å…¬å¸é™„è¿‘çš„é—¨åº—
- æƒ³è¦ç›‘æ§å¤šä¸ªé¢œè‰²/å®¹é‡çš„å¤‡é€‰
- å¸Œæœ›å¢åŠ æŠ¢åˆ°çš„æ¦‚ç‡

**é¢‘ç‡ä¼˜åŠ¿ï¼š**
```
å•é—¨åº—+3äº§å“ = 5.45æ¬¡/åˆ†é’Ÿ âœ…
å•é—¨åº—+5äº§å“ = 8.57æ¬¡/åˆ†é’Ÿ âœ…
ï¼ˆæ¯”å¤šé—¨åº—æ–¹æ¡ˆæ›´å®‰å…¨ï¼ï¼‰
```

---

### åŠŸèƒ½2ï¼šé¦™æ¸¯é—¨åº—æ”¯æŒ

**åŠŸèƒ½è¯´æ˜ï¼š**
- æ”¯æŒé¦™æ¸¯4å®¶Apple Store
- è‡ªåŠ¨é€‚é…é¦™æ¸¯APIç«¯ç‚¹
- æ”¯æŒç¹ä½“ä¸­æ–‡æ˜¾ç¤º

**é¦™æ¸¯é—¨åº—åˆ—è¡¨ï¼š**
1. R428 - Apple åœ‹éš›é‡‘èä¸­å¿ƒ (IFC Mall) - ä¸­ç’°
2. R485 - Apple åˆä¸€åŸ (Festival Walk) - ä¹é¾å¡˜
3. R499 - Apple éŠ…é‘¼ç£ (Causeway Bay) - éŠ…é‘¼ç£
4. R644 - Apple å°–æ²™å’€ (Canton Road) - å°–æ²™å’€

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åœºæ™¯1ï¼šå•é—¨åº—+å¤šäº§å“ï¼ˆä¸­å›½å¤§é™†ï¼‰

#### æ­¥éª¤1ï¼šä½¿ç”¨é…ç½®æ¨¡æ¿

```bash
cd /Users/kellychen/CodeBuddy/applepick

# ä½¿ç”¨å•é—¨åº—+å¤šäº§å“é…ç½®
cp config_single_store_multi_product.json config.json
```

#### æ­¥éª¤2ï¼šéªŒè¯é…ç½®

```bash
python3 rate_calculator.py
# é€‰æ‹© 1 - åˆ†æé…ç½®æ–‡ä»¶
```

**é¢„æœŸè¾“å‡ºï¼š**
```
é…ç½®å‚æ•°ï¼š
  â€¢ ç›‘æ§äº§å“æ•°ï¼š3 ä¸ª
  â€¢ ç›‘æ§é—¨åº—æ•°ï¼š1 ä¸ª
  â€¢ æ£€æŸ¥é—´éš”ï¼š30 ç§’

é£é™©è¯„ä¼°ï¼š
  â€¢ å®é™…é¢‘ç‡ï¼š5.45 æ¬¡/åˆ†é’Ÿ
  â€¢ é£é™©çº§åˆ«ï¼šâœ… å®‰å…¨
```

#### æ­¥éª¤3ï¼šè¿è¡Œç¨‹åº

```bash
# ä½¿ç”¨å¢å¼ºç‰ˆç›‘æ§å™¨
python3 main_enhanced.py
```

---

### åœºæ™¯2ï¼šé¦™æ¸¯é—¨åº—ç›‘æ§

#### æ­¥éª¤1ï¼šä½¿ç”¨é¦™æ¸¯é…ç½®

```bash
# ä½¿ç”¨é¦™æ¸¯é—¨åº—é…ç½®
cp config_hongkong_example.json config.json
```

#### æ­¥éª¤2ï¼šç¡®è®¤Part Number

**é‡è¦æç¤ºï¼š** é¦™æ¸¯ç‰ˆiPhoneçš„Part Numberæ ¼å¼ä¸åŒï¼

```
ä¸­å›½å¤§é™†ï¼šMXUA3CH/Aï¼ˆä»¥CH/Aç»“å°¾ï¼‰
é¦™æ¸¯ï¼šMXUA3ZP/Aï¼ˆä»¥ZP/Aç»“å°¾ï¼‰
```

**è·å–é¦™æ¸¯Part Numberï¼š**
1. è®¿é—®é¦™æ¸¯Appleå®˜ç½‘ï¼šhttps://www.apple.com/hk
2. é€‰æ‹©äº§å“é…ç½®
3. æŸ¥çœ‹APIè¯·æ±‚ä¸­çš„partså‚æ•°

#### æ­¥éª¤3ï¼šè¿è¡Œç¨‹åº

```bash
python3 main_enhanced.py
```

---

## ğŸ“ é…ç½®è¯¦è§£

### é…ç½®æ–‡ä»¶ç»“æ„ï¼ˆæ–°å¢å­—æ®µï¼‰

```json
{
  "region": "CN",  // æ–°å¢ï¼šåŒºåŸŸé€‰æ‹© CN=ä¸­å›½å¤§é™†, HK=é¦™æ¸¯
  
  "target_products": [
    {
      "name": "äº§å“åç§°",
      "part_number": "å‹å·ç¼–å·",
      "color": "é¢œè‰²",
      "storage": "å®¹é‡"
    }
  ],
  
  "target_stores": ["R678"],  // å¯ä»¥æ˜¯1ä¸ªæˆ–å¤šä¸ª
  
  "check_interval": 30
}
```

### åŒºåŸŸé…ç½®

| åŒºåŸŸä»£ç  | åŒºåŸŸåç§° | APIç«¯ç‚¹ | Part Numberæ ¼å¼ |
|---------|---------|---------|----------------|
| **CN** | ä¸­å›½å¤§é™† | apple.com.cn | CH/A |
| **HK** | é¦™æ¸¯ | apple.com/hk | ZP/A |

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯Aï¼šä¸Šæµ·ç™½é¢†ï¼ˆå•é—¨åº—+å¤šäº§å“ï¼‰

**éœ€æ±‚ï¼š**
- ä¸Šç­æ—ï¼Œåªèƒ½å»å…¬å¸é™„è¿‘çš„é™å®‰Apple Store
- æƒ³è¦iPhone 16 Plusï¼Œä½†é¢œè‰²å’Œå®¹é‡è¿˜æ²¡å†³å®š
- å¸Œæœ›å¤šä¸ªå¤‡é€‰ï¼Œæ€»æœ‰ä¸€æ¬¾èƒ½ä¹°åˆ°

**é…ç½®ï¼š**

```json
{
  "region": "CN",
  "target_products": [
    {"part_number": "MXUA3CH/A", "name": "ç™½è‰² 128GB"},
    {"part_number": "MXUB3CH/A", "name": "ç™½è‰² 256GB"},
    {"part_number": "MXUC3CH/A", "name": "é»‘è‰² 128GB"},
    {"part_number": "MXUD3CH/A", "name": "é»‘è‰² 256GB"},
    {"part_number": "MXUE3CH/A", "name": "è“è‰² 128GB"}
  ],
  "target_stores": ["R678"],
  "check_interval": 30
}
```

**é¢‘ç‡åˆ†æï¼š**
```
5ä¸ªäº§å“ Ã— 1ä¸ªé—¨åº— = 5æ¬¡è¯·æ±‚
æ€»å‘¨æœŸ = 5 + 30 = 35ç§’
é¢‘ç‡ = 5/35Ã—60 = 8.57æ¬¡/åˆ†é’Ÿ âœ… å®‰å…¨
```

---

### åœºæ™¯Bï¼šé¦™æ¸¯ç”¨æˆ·ï¼ˆé¦™æ¸¯é—¨åº—ï¼‰

**éœ€æ±‚ï¼š**
- ä½åœ¨é¦™æ¸¯ä¸­ç¯
- æƒ³åœ¨IFC Mallçš„Apple Storeè´­ä¹°
- ç›‘æ§1-2ä¸ªå‹å·

**é…ç½®ï¼š**

```json
{
  "region": "HK",
  "target_products": [
    {
      "part_number": "MXUA3ZP/A",
      "name": "iPhone 16 Plus White 128GB"
    }
  ],
  "target_stores": ["R428"],
  "check_interval": 30
}
```

**é¢‘ç‡åˆ†æï¼š**
```
1ä¸ªäº§å“ Ã— 1ä¸ªé—¨åº— = 1æ¬¡è¯·æ±‚
æ€»å‘¨æœŸ = 1 + 30 = 31ç§’
é¢‘ç‡ = 1/31Ã—60 = 1.94æ¬¡/åˆ†é’Ÿ âœ… æåº¦å®‰å…¨
```

---

### åœºæ™¯Cï¼šå¤šä¸ªé¦™æ¸¯é—¨åº—

**éœ€æ±‚ï¼š**
- æ„¿æ„å»é¦™æ¸¯ä»»ä½•ä¸€å®¶Apple Store
- ç›‘æ§2ä¸ªå‹å·

**é…ç½®ï¼š**

```json
{
  "region": "HK",
  "target_products": [
    {"part_number": "MXUA3ZP/A", "name": "White 128GB"},
    {"part_number": "MXUB3ZP/A", "name": "White 256GB"}
  ],
  "target_stores": ["R428", "R485", "R499", "R644"],
  "check_interval": 48
}
```

**é¢‘ç‡åˆ†æï¼š**
```
2ä¸ªäº§å“ Ã— 4ä¸ªé—¨åº— = 8æ¬¡è¯·æ±‚
æ€»å‘¨æœŸ = 8 + 48 = 56ç§’
é¢‘ç‡ = 8/56Ã—60 = 8.57æ¬¡/åˆ†é’Ÿ âœ… å®‰å…¨
```

---

## ğŸ”§ ä½¿ç”¨å¢å¼ºç‰ˆç›‘æ§å™¨

### åˆ›å»ºå¯åŠ¨è„šæœ¬

åˆ›å»º `main_enhanced.py`ï¼š

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Apple Store åº“å­˜ç›‘æ§ç¨‹åº - å¢å¼ºç‰ˆ
æ”¯æŒå•é—¨åº—+å¤šäº§å“ã€é¦™æ¸¯é—¨åº—
"""

import sys
import json
import signal
from pathlib import Path
from colorama import init, Fore, Style

# å¯¼å…¥å¢å¼ºç‰ˆç›‘æ§å™¨
from apple_store_monitor_enhanced import AppleStoreMonitorEnhanced
from notifier import Notifier
from logger_config import setup_logger
from threading import Event

init(autoreset=True)
stop_event = Event()
logger = setup_logger()


def load_config(config_path='config.json'):
    """åŠ è½½é…ç½®æ–‡ä»¶"""
    try:
        with open(config_path, 'r', encoding='utf-8') as f:
            config = json.load(f)
        
        # éªŒè¯å¿…è¦å­—æ®µ
        required_fields = ['target_products']
        for field in required_fields:
            if field not in config:
                raise ValueError(f"é…ç½®æ–‡ä»¶ç¼ºå°‘å¿…è¦å­—æ®µ: {field}")
        
        # è®¾ç½®é»˜è®¤åŒºåŸŸ
        if 'region' not in config:
            config['region'] = 'CN'
            logger.warning("æœªæŒ‡å®šåŒºåŸŸï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼šCNï¼ˆä¸­å›½å¤§é™†ï¼‰")
        
        return config
    
    except Exception as e:
        logger.error(f"åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥: {e}")
        sys.exit(1)


def signal_handler(sig, frame):
    """å¤„ç†ä¸­æ–­ä¿¡å·"""
    print(f"\n{Fore.YELLOW}æ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œæ­£åœ¨å®‰å…¨é€€å‡º...{Style.RESET_ALL}\n")
    stop_event.set()


def main():
    """ä¸»å‡½æ•°"""
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
    
    print(f"\n{Fore.CYAN}{'='*70}")
    print(f"ğŸ  Apple Store åº“å­˜å®æ—¶ç›‘æ§ç³»ç»Ÿ v2.1 (å¢å¼ºç‰ˆ)")
    print(f"{'='*70}{Style.RESET_ALL}\n")
    
    # åŠ è½½é…ç½®
    logger.info("æ­£åœ¨åŠ è½½é…ç½®...")
    config = load_config()
    
    # åˆå§‹åŒ–å¢å¼ºç‰ˆç›‘æ§å™¨
    logger.info("æ­£åœ¨åˆå§‹åŒ–å¢å¼ºç‰ˆç›‘æ§å™¨...")
    monitor = AppleStoreMonitorEnhanced(config, stop_event)
    
    # æ˜¾ç¤ºé…ç½®ä¿¡æ¯
    region_name = monitor.region_config['name']
    product_count = len(config['target_products'])
    store_count = len(config.get('target_stores', []))
    
    print(f"{Fore.GREEN}âœ… ç›‘æ§é…ç½®ï¼š{Style.RESET_ALL}")
    print(f"  â€¢ åŒºåŸŸï¼š{region_name}")
    print(f"  â€¢ äº§å“æ•°ï¼š{product_count} ä¸ª")
    print(f"  â€¢ é—¨åº—æ•°ï¼š{store_count} ä¸ª")
    print(f"  â€¢ æ£€æŸ¥é—´éš”ï¼š{config.get('check_interval', 30)} ç§’")
    
    # è®¡ç®—é¢‘ç‡
    one_round = product_count * store_count
    total_cycle = one_round + config.get('check_interval', 30)
    rate = one_round / total_cycle * 60
    
    print(f"  â€¢ é¢„è®¡é¢‘ç‡ï¼š{rate:.2f} æ¬¡/åˆ†é’Ÿ")
    
    if rate > 10:
        print(f"\n{Fore.RED}âš ï¸  è­¦å‘Šï¼šé¢‘ç‡å¯èƒ½è¿‡é«˜ï¼{Style.RESET_ALL}")
        print(f"å»ºè®®ä½¿ç”¨ rate_calculator.py éªŒè¯é…ç½®\n")
    else:
        print(f"  â€¢ å®‰å…¨æ€§ï¼šâœ… å®‰å…¨\n")
    
    # åˆå§‹åŒ–é€šçŸ¥å™¨
    notifier = Notifier(config)
    
    print(f"{Fore.GREEN}âœ¨ ç›‘æ§å·²å¯åŠ¨ï¼{Style.RESET_ALL}\n")
    print(f"{Fore.YELLOW}ğŸ’¡ æç¤º: æŒ‰ Ctrl+C å¯éšæ—¶åœæ­¢{Style.RESET_ALL}\n")
    
    # å¼€å§‹ç›‘æ§å¾ªç¯
    try:
        iteration = 0
        while not stop_event.is_set():
            iteration += 1
            logger.info(f"å¼€å§‹ç¬¬ {iteration} è½®æ£€æŸ¥...")
            
            # æ£€æŸ¥åº“å­˜
            results = monitor.check_multiple_products(
                config['target_products'],
                config.get('target_stores')
            )
            
            # å¤„ç†ç»“æœå’Œå‘é€é€šçŸ¥
            for part_number, data in results.items():
                product = data.get('product', {})
                result = data.get('result', {})
                
                if result.get('success'):
                    available_stores = result.get('available_stores', [])
                    
                    if available_stores:
                        if len(available_stores) == 1:
                            notifier.notify_stock_available(product, available_stores[0])
                        else:
                            notifier.notify_multiple_stores_available(product, available_stores)
                        
                        logger.info(f"ğŸ‰ {product.get('name')} åœ¨ {len(available_stores)} ä¸ªé—¨åº—æœ‰è´§ï¼")
            
            # ç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥
            check_interval = config.get('check_interval', 30)
            logger.info(f"æœ¬è½®æ£€æŸ¥å®Œæˆï¼Œ{check_interval}ç§’åè¿›è¡Œä¸‹ä¸€è½®...")
            stop_event.wait(check_interval)
    
    except KeyboardInterrupt:
        pass
    except Exception as e:
        logger.error(f"ç¨‹åºå¼‚å¸¸: {e}")
    
    # å¯¼å‡ºå†å²
    if config.get('save_history', True):
        logger.info("æ­£åœ¨å¯¼å‡ºå†å²è®°å½•...")
        monitor.export_history()
    
    print(f"\n{Fore.CYAN}ç¨‹åºå·²é€€å‡ºã€‚æ„Ÿè°¢ä½¿ç”¨ï¼{Style.RESET_ALL}\n")
    logger.info("ç¨‹åºæ­£å¸¸é€€å‡º")


if __name__ == "__main__":
    main()
```

### è¿è¡Œå¢å¼ºç‰ˆ

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x main_enhanced.py

# è¿è¡Œ
python3 main_enhanced.py
```

---

## ğŸ“Š é¢‘ç‡å¯¹æ¯”

### å•é—¨åº— vs å¤šé—¨åº—

| é…ç½® | äº§å“æ•° | é—¨åº—æ•° | é¢‘ç‡ | å®‰å…¨æ€§ |
|------|--------|--------|------|--------|
| å•é—¨åº—+3äº§å“ | 3 | 1 | 5.45æ¬¡/åˆ† | âœ…âœ…âœ… |
| å•é—¨åº—+5äº§å“ | 5 | 1 | 8.57æ¬¡/åˆ† | âœ…âœ…âœ… |
| å•äº§å“+5é—¨åº— | 1 | 5 | 8.57æ¬¡/åˆ† | âœ…âœ… |
| å•äº§å“+8é—¨åº— | 1 | 8 | 26.67æ¬¡/åˆ† | âŒâŒ |

**ç»“è®ºï¼š** å•é—¨åº—+å¤šäº§å“çš„é¢‘ç‡æ›´ä½ï¼Œæ›´å®‰å…¨ï¼

---

## âš ï¸ é‡è¦æé†’

### Part Numberå·®å¼‚

**ä¸­å›½å¤§é™†ï¼š**
```
iPhone 16 Plus ç™½è‰² 128GB: MXUA3CH/A
```

**é¦™æ¸¯ï¼š**
```
iPhone 16 Plus ç™½è‰² 128GB: MXUA3ZP/A
```

**æ³¨æ„ï¼š** ç»“å°¾ä¸åŒï¼ˆCH/A vs ZP/Aï¼‰

### APIç«¯ç‚¹

**ä¸­å›½å¤§é™†ï¼š**
```
https://www.apple.com.cn/shop/retail/pickup-message
```

**é¦™æ¸¯ï¼š**
```
https://www.apple.com/hk/shop/retail/pickup-message
```

**è‡ªåŠ¨å¤„ç†ï¼š** å¢å¼ºç‰ˆç›‘æ§å™¨ä¼šæ ¹æ®regionè‡ªåŠ¨é€‰æ‹©

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å•é—¨åº—+å¤šäº§å“

**æ¨èé…ç½®ï¼š**
- äº§å“æ•°ï¼š3-5ä¸ª
- é—¨åº—æ•°ï¼š1ä¸ª
- é—´éš”ï¼š30ç§’
- é¢‘ç‡ï¼š5-9æ¬¡/åˆ†é’Ÿ

**ä¼˜åŠ¿ï¼š**
- é¢‘ç‡æœ€ä½
- é…ç½®æœ€ç®€å•
- æœ€ç¬¦åˆä½¿ç”¨ä¹ æƒ¯

### 2. é¦™æ¸¯é—¨åº—

**æ¨èé…ç½®ï¼š**
- äº§å“æ•°ï¼š1-2ä¸ª
- é—¨åº—æ•°ï¼š1-2ä¸ª
- é—´éš”ï¼š30ç§’
- é¢‘ç‡ï¼š2-4æ¬¡/åˆ†é’Ÿ

**æ³¨æ„ï¼š**
- ä½¿ç”¨ZP/Aç»“å°¾çš„Part Number
- è®¾ç½®regionä¸º"HK"

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šé¦™æ¸¯é—¨åº—æŸ¥è¯¢å¤±è´¥

**æ£€æŸ¥ï¼š**
1. regionè®¾ç½®æ˜¯å¦ä¸º"HK"
2. Part Numberæ˜¯å¦æ˜¯ZP/Aç»“å°¾
3. é—¨åº—ç¼–å·æ˜¯å¦æ­£ç¡®

### é—®é¢˜2ï¼šé¢‘ç‡ä»ç„¶è¿‡é«˜

**è§£å†³ï¼š**
```bash
# ä½¿ç”¨è®¡ç®—å·¥å…·éªŒè¯
python3 rate_calculator.py

# å¢åŠ check_interval
# æˆ–å‡å°‘äº§å“/é—¨åº—æ•°é‡
```

### é—®é¢˜3ï¼šç¨‹åºæ— æ³•å¯åŠ¨

**æ£€æŸ¥ï¼š**
1. æ˜¯å¦å®‰è£…äº†æ‰€æœ‰ä¾èµ–
2. é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
3. apple_stores_hongkong.jsonæ˜¯å¦å­˜åœ¨

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å•é—¨åº—å¤šäº§å“åˆ†æ.md** - è¯¦ç»†çš„é¢‘ç‡åˆ†æ
- **Apple_API_é˜²çˆ¬è™«è§„åˆ™æ€»ç»“.md** - APIé™åˆ¶è§„åˆ™
- **rate_calculator.py** - é¢‘ç‡è®¡ç®—å·¥å…·

---

## âœ… å¿«é€Ÿæ£€æŸ¥æ¸…å•

ä½¿ç”¨æ–°åŠŸèƒ½å‰ï¼š

- [ ] å·²é€‰æ‹©åŒºåŸŸï¼ˆCNæˆ–HKï¼‰
- [ ] Part Numberæ ¼å¼æ­£ç¡®
- [ ] ä½¿ç”¨rate_calculatoréªŒè¯
- [ ] é¢‘ç‡ â‰¤ 10æ¬¡/åˆ†é’Ÿ
- [ ] å·²æµ‹è¯•è¿è¡Œ10åˆ†é’Ÿ

---

**æ›´æ–°æ—¶é—´ï¼š** 2025-10-06  
**ç‰ˆæœ¬ï¼š** v2.1  
**æ–°åŠŸèƒ½ï¼š** å•é—¨åº—+å¤šäº§å“ã€é¦™æ¸¯é—¨åº—æ”¯æŒ

**ğŸ‰ äº«å—æ–°åŠŸèƒ½ï¼**


