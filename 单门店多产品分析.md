# 📊 单门店+多产品场景分析

> **功能需求：** 监控单个门店的多个产品  
> **典型场景：** 在家附近的Apple Store监控多个心仪型号

---

## 🎯 场景说明

### 使用场景

**适合人群：**
- 只关心家附近/公司附近的某个门店
- 想要监控多个产品配置（不同颜色、容量）
- 希望一旦该门店有任何一款有货就去购买

**举例：**
```
用户住在上海，只想去家附近的"Apple 静安"购买
同时监控：
- iPhone 16 Plus 白色 128GB
- iPhone 16 Plus 白色 256GB  
- iPhone 16 Plus 黑色 128GB
```

---

## 📐 频率计算

### 计算公式

```
单门店+多产品频率 = 产品数 / (产品数 × 1秒 + check_interval) × 60

简化：
频率 = 产品数 / (产品数 + check_interval) × 60
```

### 示例计算

#### 场景A：3个产品

```json
{
  "target_products": [3个],
  "target_stores": [1个],
  "check_interval": 30
}
```

**计算：**
```
一轮耗时 = 3个产品 × 1秒 = 3秒
总周期 = 3 + 30 = 33秒
频率 = 3 / 33 × 60 = 5.45次/分钟 ✅ 安全
```

#### 场景B：5个产品

```json
{
  "target_products": [5个],
  "target_stores": [1个],
  "check_interval": 30
}
```

**计算：**
```
一轮耗时 = 5秒
总周期 = 35秒
频率 = 5 / 35 × 60 = 8.57次/分钟 ✅ 安全
```

#### 场景C：10个产品

```json
{
  "target_products": [10个],
  "target_stores": [1个],
  "check_interval": 30
}
```

**计算：**
```
一轮耗时 = 10秒
总周期 = 40秒
频率 = 10 / 40 × 60 = 15次/分钟 ⚠️ 有风险
```

**建议：** 增加check_interval到60秒
```
总周期 = 70秒
频率 = 10 / 70 × 60 = 8.57次/分钟 ✅ 安全
```

---

## 📊 安全配置表

| 产品数 | 门店数 | 最小间隔 | 推荐间隔 | 频率 | 风险 |
|--------|--------|---------|---------|------|------|
| 3个 | 1个 | 15秒 | 30秒 | 5.45次/分 | ✅ 安全 |
| 5个 | 1个 | 24秒 | 30秒 | 8.57次/分 | ✅ 安全 |
| 8个 | 1个 | 42秒 | 48秒 | 8.57次/分 | ✅ 安全 |
| 10个 | 1个 | 54秒 | 60秒 | 8.57次/分 | ✅ 安全 |
| 15个 | 1个 | 75秒 | 90秒 | 10次/分 | ✅ 安全 |

---

## ⚡ 优势分析

### vs 单产品+多门店

**单门店+多产品的优势：**

1. **请求频率更低**
   ```
   3产品×1门店 = 5.45次/分钟
   1产品×5门店 = 8.57次/分钟
   ```
   监控更多型号，但频率更低！

2. **更符合使用习惯**
   - 大多数人只关心家附近的门店
   - 但想要多个备选型号

3. **更容易满足**
   - 多个型号，总有一款有货
   - 不用跑多个门店

4. **配置更简单**
   - 只需要一个门店编号
   - 产品型号容易获取

---

## 🎯 推荐配置

### 标准配置（3-5个产品）⭐

```json
{
  "target_products": [
    {
      "name": "iPhone 16 Plus 白色 128GB",
      "part_number": "MXUA3CH/A",
      "color": "白色",
      "storage": "128GB"
    },
    {
      "name": "iPhone 16 Plus 白色 256GB", 
      "part_number": "MXUB3CH/A",
      "color": "白色",
      "storage": "256GB"
    },
    {
      "name": "iPhone 16 Plus 黑色 128GB",
      "part_number": "MXUC3CH/A",
      "color": "黑色",
      "storage": "128GB"
    }
  ],
  "target_stores": ["R678"],
  "_store_info": "R678 = 上海静安",
  "check_interval": 30
}
```

**效果：**
- 频率：5.45次/分钟 ✅
- 监控3个型号
- 35秒检查一轮
- 完全安全

---

### 密集监控（8-10个产品）

```json
{
  "target_products": [8-10个产品],
  "target_stores": ["R678"],
  "check_interval": 60
}
```

**效果：**
- 频率：8.57次/分钟 ✅
- 监控更多型号
- 70秒检查一轮
- 完全安全

---

## 🔄 与多门店对比

### 场景对比

| 维度 | 单门店+多产品 | 多门店+单产品 |
|------|--------------|--------------|
| **监控范围** | 1个门店，多个型号 | 多个门店，1个型号 |
| **请求频率** | 低（5-9次/分） | 高（8-10次/分） |
| **灵活性** | 型号选择灵活 | 地理范围灵活 |
| **抢购难度** | 低（只去一个门店） | 高（可能要跑多个门店） |
| **配置复杂度** | 简单 | 中等 |

### 什么时候选择单门店+多产品？

✅ **推荐使用：**
- 只关心某个特定门店
- 对型号/颜色/容量不确定
- 希望有更多选择余地
- 想要更低的请求频率

❌ **不推荐：**
- 需要覆盖多个地区
- 已经明确要某个特定型号
- 某个门店很难有货

---

## 💡 实用建议

### 1. 选择产品

**推荐策略：**
- 选择3-5个最想要的配置
- 包含不同容量作为备选
- 包含不同颜色作为备选

**示例组合：**
```
主选：iPhone 16 Plus 白色 256GB
备选1：iPhone 16 Plus 白色 128GB（容量小一些）
备选2：iPhone 16 Plus 黑色 256GB（颜色备选）
备选3：iPhone 16 Plus 蓝色 256GB（另一颜色）
```

### 2. 选择门店

**选择原则：**
- 离家/公司最近
- 货源相对充足的大店
- 交通便利

**推荐门店：**
- 上海：R678（静安）、R359（南京东路）
- 北京：R448（王府井）、R479（华贸）
- 深圳：R761（万象城）
- 广州：R577（天环）

### 3. 设置间隔

**根据产品数：**
- 3-5个产品：check_interval = 30秒
- 6-8个产品：check_interval = 48秒
- 9-10个产品：check_interval = 60秒
- >10个产品：check_interval = 90秒

---

## 📝 配置模板

### 模板1：3个产品（推荐）⭐

```json
{
  "target_products": [
    {
      "name": "iPhone 16 Plus 白色 128GB",
      "part_number": "MXUA3CH/A",
      "color": "白色",
      "storage": "128GB"
    },
    {
      "name": "iPhone 16 Plus 白色 256GB",
      "part_number": "MXUB3CH/A",
      "color": "白色",
      "storage": "256GB"
    },
    {
      "name": "iPhone 16 Plus 黑色 128GB",
      "part_number": "MXUC3CH/A",
      "color": "黑色",
      "storage": "128GB"
    }
  ],
  "all_stores": false,
  "target_stores": ["R678"],
  "check_interval": 30,
  "enable_notification": true,
  "enable_sound": true,
  "_comment": "单门店+3产品，频率5.45次/分钟，完全安全"
}
```

### 模板2：5个产品

```json
{
  "target_products": [5个产品配置],
  "target_stores": ["R678"],
  "check_interval": 30,
  "_comment": "单门店+5产品，频率8.57次/分钟，完全安全"
}
```

### 模板3：10个产品（密集监控）

```json
{
  "target_products": [10个产品配置],
  "target_stores": ["R678"],
  "check_interval": 60,
  "_comment": "单门店+10产品，频率8.57次/分钟，完全安全"
}
```

---

## ✅ 验证方法

### 使用计算工具

```bash
# 修改配置后验证
python3 rate_calculator.py

# 输出应该显示：
# 请求频率：< 10次/分钟
# 风险级别：✅ 安全
```

### 运行测试

```bash
# 测试运行10分钟
timeout 600 python3 main.py

# 检查日志
grep "HTTP 541" monitor.log
# 应该没有输出
```

---

## 🎯 总结

### 核心优势

1. **更低的频率** - 比多门店方案更安全
2. **更符合习惯** - 大多数人只关心一个门店
3. **更多选择** - 可以监控多个型号
4. **更易抢到** - 多个型号总有一款有货

### 推荐配置

```
产品数：3-5个
门店数：1个
间隔：30秒
频率：5-9次/分钟
风险：✅ 极低
```

### 使用建议

- 选择离你最近的门店
- 配置3-5个最想要的型号
- 使用30秒检查间隔
- 用rate_calculator验证安全性

---

**文档创建时间：** 2025-10-06  
**适用场景：** 单门店+多产品监控  
**安全性：** ⭐⭐⭐⭐⭐


