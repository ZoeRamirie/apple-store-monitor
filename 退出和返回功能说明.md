# 退出和返回功能说明

## ✅ 功能概述

交互式配置现在支持在**每一个步骤**都可以：
- 🚪 **退出程序**：输入 `0`
- ↩️ **返回上一步**：输入 `b`

---

## 📋 功能详情

### 步骤1: 策略选择

```
======================================================================
📊 步骤1: 选择监控策略
======================================================================

  1. 保守策略（推荐新手）
  2. 平衡策略（推荐）
  3. 积极策略
  4. 激进策略（高风险）
  5. 自定义配置
  
  0. 退出程序                    ← 新增！

请选择策略 (1-5, 0=退出):
```

**可用操作**：
- `1-5`: 选择策略
- `0`: 退出程序

---

### 步骤2: 产品选择

```
======================================================================
📱 步骤2: 选择监控产品
======================================================================

产品系列:
  1. iPhone 16 标准版（1个型号）- 测试用
  2. iPhone 16 Plus（1个型号）- 测试用
  3. iPhone 17 标准版（10个型号）
  4. iPhone 17 Pro（9个型号）
  5. iPhone 17 Pro Max（12个型号）

💡 提示：可以选择多个系列，用逗号分隔（如: 1,3,5）
特殊选项: 0=退出程序, b=返回上一步          ← 新增！

请选择系列 (1-5，多选用逗号分隔):
```

**可用操作**：
- `1-5`: 选择系列（可多选）
- `0`: 退出程序
- `b`: 返回步骤1（重新选择策略）

---

### 步骤3: 门店选择

#### 3.1 选择城市

```
======================================================================
🏪 步骤3: 选择监控门店
======================================================================

可选城市:
   1. beijing (4家门店)
   2. shanghai (7家门店)
   3. shenzhen (3家门店)
   ...

特殊选项: 0=退出程序, b=返回上一步          ← 新增！

请选择城市（多选用逗号分隔，如: 1,2,3）:
```

**可用操作**：
- `1-N`: 选择城市（可多选）
- `0`: 退出程序
- `b`: 返回步骤2（重新选择产品）

#### 3.2 选择门店

```
可选门店:
  1. 王府井 (beijing-东城区) 🔥
  2. 三里屯 (beijing-朝阳区) 🔥
  3. 西单大悦城 (beijing-西城区) ⭐
  ...

💡 建议最多选择 3 个门店
特殊选项: 0=退出程序, b=返回上一步（重新选择城市）  ← 新增！

请选择门店（多选用逗号分隔）:
```

**可用操作**：
- `1-N`: 选择门店（可多选）
- `0`: 退出程序
- `b`: 返回3.1（重新选择城市）

---

### 步骤4: 确认配置

```
======================================================================
📋 配置摘要
======================================================================

监控产品 (2个):
  • iPhone 16 黑色 128GB
  • iPhone 17 Pro Max 深墨蓝色 256GB

监控门店 (3个):
  • 王府井 (beijing)
  • 三里屯 (beijing)
  • 西单大悦城 (beijing)

监控参数:
  • 检查间隔: 60秒
  • 每轮请求: 6次
  • 请求频率: 9.0次/分钟 ✅ 低

特殊选项: 0=退出程序, b=返回重新选择          ← 新增！

确认使用此配置？(y/n/b/0):
```

**可用操作**：
- `y`: 确认并保存配置
- `n`: 取消
- `b`: 返回步骤3（重新选择门店）
- `0`: 退出程序

---

## 🎯 使用场景

### 场景1: 选错策略，想重选

```
步骤1: 选择策略 → 选了 4（激进）
步骤2: 选择产品 → 发现策略太激进，输入 b
     ↩️ 返回步骤1 → 重新选择 2（平衡）
步骤2: 选择产品 → 继续配置...
```

### 场景2: 选错产品系列

```
步骤1: 选择策略 → 2（平衡）
步骤2: 选择产品 → 选了 1,2（错误组合），输入 b
     ↩️ 返回步骤1（但可以直接继续）
步骤2: 选择产品 → 重新输入 1,5（正确组合）
```

### 场景3: 选错城市/门店

```
步骤3.1: 选择城市 → 1（北京）
步骤3.2: 选择门店 → 发现想选上海，输入 b
      ↩️ 返回步骤3.1 → 选择 2（上海）
步骤3.2: 选择门店 → 继续...
```

### 场景4: 临时退出

```
步骤2: 选择产品 → 突然有事，输入 0
     👋 程序退出
     
# 下次重新运行 python3 start.py 即可
```

### 场景5: 确认前发现错误

```
步骤4: 确认配置 → 发现门店选错了，输入 b
     ↩️ 返回步骤3 → 重新选择门店
步骤4: 确认配置 → 输入 y，完成！
```

---

## 🔄 流程图

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  步骤1: 选择策略                                        │
│  ┌────────────────────────────┐                        │
│  │ 输入: 1-5                  │                        │
│  │ 特殊: 0=退出              │                        │
│  └───────┬────────────────────┘                        │
│          │                                             │
│          ↓                                             │
│  步骤2: 选择产品                                        │
│  ┌────────────────────────────┐                        │
│  │ 输入: 1-5 (多选)           │                        │
│  │ 特殊: 0=退出, b=返回步骤1  │ ← b 返回               │
│  └───────┬────────────────────┘                        │
│          │                     ↑                       │
│          ↓                     │                       │
│  步骤3.1: 选择城市                                      │
│  ┌────────────────────────────┐                        │
│  │ 输入: 1-N (多选)           │                        │
│  │ 特殊: 0=退出, b=返回步骤2  │ ← b 返回               │
│  └───────┬────────────────────┘                        │
│          │                     ↑                       │
│          ↓                     │                       │
│  步骤3.2: 选择门店                                      │
│  ┌────────────────────────────┐                        │
│  │ 输入: 1-N (多选)           │                        │
│  │ 特殊: 0=退出, b=返回3.1    │ ← b 返回选城市         │
│  └───────┬────────────────────┘                        │
│          │                     ↑                       │
│          ↓                     │                       │
│  步骤4: 确认配置                                        │
│  ┌────────────────────────────┐                        │
│  │ 输入: y=确认, n=取消       │                        │
│  │ 特殊: 0=退出, b=返回步骤3  │ ← b 返回               │
│  └───────┬────────────────────┘                        │
│          │                                             │
│          ↓                                             │
│        完成！                                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 💡 提示

### 何时使用 "0" (退出)

- 突然有急事需要离开
- 不想继续配置
- 想重新开始整个流程

### 何时使用 "b" (返回)

- 选错了选项
- 想修改上一步的选择
- 想尝试不同的配置组合

### 返回的层级

- **步骤2 输入 b**: 返回步骤1（策略选择）
- **步骤3.1 输入 b**: 返回步骤2（产品选择）
- **步骤3.2 输入 b**: 返回步骤3.1（城市选择）
- **确认页面 输入 b**: 返回步骤3（门店选择）

---

## 🚀 完整示例

### 示例1: 正常流程（无返回）

```bash
python3 start.py

1. 选择区域: 1 (中国大陆)
2. 选择配置: 1 (交互式配置)
3. 选择策略: 2 (平衡)
4. 选择产品系列: 1,5 (iPhone 16 + iPhone 17 Pro Max)
5. 选择型号: 1,3,5
6. 选择城市: 1 (北京)
7. 选择门店: 1,2,3
8. 确认: y

✅ 配置完成！
```

### 示例2: 带返回的流程

```bash
python3 start.py

1. 选择区域: 1
2. 选择配置: 1
3. 选择策略: 4 (激进)
4. 选择产品系列: b           ← 返回！
3. 选择策略: 2 (平衡)        ← 重新选择
4. 选择产品系列: 1,5
5. 选择型号: 1,3,5
6. 选择城市: 1
7. 选择门店: 1,2,3,4,5,6     ← 选多了
8. 确认: b                   ← 返回！
7. 选择门店: 1,2,3           ← 重新选择
8. 确认: y

✅ 配置完成！
```

### 示例3: 临时退出

```bash
python3 start.py

1. 选择区域: 1
2. 选择配置: 1
3. 选择策略: 2
4. 选择产品系列: 0           ← 退出！

👋 已退出配置

# 稍后重新运行
python3 start.py
```

---

## ⚙️ 技术实现

### 返回值约定

```python
# 正常返回
return products  # 返回产品列表

# 特殊返回值
return 'EXIT'       # 退出程序
return 'BACK'       # 返回上一步
return 'BACK_TO_CITY'  # 返回到城市选择（门店选择专用）
```

### 循环结构

```python
def generate(self):
    # 步骤1循环
    while True:
        strategy = self.select_strategy()
        if strategy is None:
            return None  # 退出
        
        # 步骤2循环
        while True:
            products = self.select_products()
            if products == 'EXIT':
                return None
            elif products == 'BACK':
                break  # 返回步骤1
            
            # 步骤3循环
            while True:
                stores = self.select_stores()
                if stores == 'EXIT':
                    return None
                elif stores == 'BACK':
                    break  # 返回步骤2
                
                # 确认配置
                confirm = input("确认？(y/n/b/0): ")
                if confirm == 'y':
                    return config
                elif confirm == 'b':
                    break  # 返回步骤3
```

---

## 📊 功能对比

| 功能 | 修改前 | 修改后 |
|-----|--------|--------|
| 退出程序 | 只能 Ctrl+C | ✅ 每步都可输入 0 |
| 返回上一步 | 不支持 | ✅ 每步都可输入 b |
| 重新选择 | 需要重启程序 | ✅ 直接返回修改 |
| 用户体验 | 一次性流程 | ✅ 灵活可控 |

---

## 🎉 总结

现在的交互式配置更加人性化：

1. ✅ **随时退出** - 每一步都可以输入 `0` 退出
2. ✅ **灵活返回** - 每一步都可以输入 `b` 返回上一步
3. ✅ **无需重启** - 选错了可以直接返回修改
4. ✅ **清晰提示** - 每一步都显示可用的特殊选项
5. ✅ **逻辑清晰** - 返回层级明确，不会迷路

---

## 🚀 立即体验

```bash
python3 start.py
```

试试在配置过程中：
- 输入 `0` 退出程序
- 输入 `b` 返回上一步
- 输入 `y` 确认配置

享受更流畅的配置体验！


