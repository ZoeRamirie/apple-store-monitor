# 🔍 香港门店编号验证报告

> **验证时间：** 2025-10-06  
> **目的：** 确保香港门店编号准确，避免监测不响应

---

## ⚠️ 发现的问题

### 当前香港门店配置

当前 `apple_stores_hongkong.json` 包含4个门店：

| 编号 | 门店名称 | 位置 |
|------|---------|------|
| R428 | Apple 國際金融中心 (IFC Mall) | 中環 |
| R485 | Apple 又一城 | 九龍塘 |
| R499 | Apple 銅鑼灣 | 銅鑼灣 |
| R644 | Apple 尖沙咀 | 尖沙咀 |

### 验证结果

使用Apple API实际测试后发现：

```
✅ 有效门店: 0 个
❌ 无效门店: 4 个
📈 成功率: 0.0%
```

**所有门店编号都返回"响应结构不正确"错误！**

---

## 🔬 问题分析

### 可能原因

1. **API端点差异**
   - 香港API可能使用不同的端点
   - 响应结构与大陆不同

2. **门店编号格式**
   - 香港可能不使用R开头的编号
   - 或者编号范围不同

3. **Part Number测试**
   - 使用的测试Part Number可能不适合香港

4. **API参数**
   - 香港API可能需要不同的参数配置

---

## ✅ 解决方案

### 方案1：使用Apple官方Store List API（推荐）⭐

**优势：**
- 官方API，数据准确
- 包含所有门店信息
- 实时更新

**实施步骤：**

1. **获取官方门店列表**
   ```bash
   python3 fetch_real_hongkong_stores.py
   ```

2. **API说明**
   ```
   Apple官方门店列表API：
   https://www.apple.com/rsp-web/store-list?locale=zh_HK
   
   返回所有门店的完整信息：
   - 门店编号（storeId）
   - 门店名称
   - 地址
   - 经纬度
   - 联系方式
   ```

3. **自动提取香港门店**
   - 脚本会自动筛选香港地区门店
   - 生成验证后的配置文件
   - 可选：验证每个门店的API响应

---

### 方案2：手动验证门店编号

**步骤1：访问Apple香港官网**

```
https://www.apple.com/hk/retail/
```

**步骤2：查看每家店的页面**

每个门店页面URL中包含真实的门店标识符，例如：
```
https://www.apple.com/hk/retail/ifcmall/
https://www.apple.com/hk/retail/festivalwalk/
```

**步骤3：使用浏览器开发者工具**

1. 访问门店页面
2. 打开开发者工具（F12）
3. 查看Network请求
4. 找到fulfillment或pickup相关的API调用
5. 查看实际使用的门店编号

---

### 方案3：扫描有效编号（最可靠）

**使用验证脚本扫描：**

```bash
python3 verify_hongkong_stores.py
# 选择 2 - 搜索实际有效的门店编号
```

**扫描范围：**
- R400-R700（常见门店编号范围）
- 每次测试间隔2秒
- 自动发现有效门店

**注意：**
- 扫描需要约10-15分钟
- 会遵守API频率限制
- 自动保存发现的有效门店

---

## 🛠️ 已提供的工具

### 工具1：门店验证脚本

**文件：** `verify_hongkong_stores.py`

**功能：**
1. 验证现有香港门店数据
2. 搜索实际有效的门店编号
3. 生成验证报告

**使用方法：**
```bash
chmod +x verify_hongkong_stores.py
python3 verify_hongkong_stores.py

# 选择操作：
# 1. 验证现有门店
# 2. 搜索新门店
```

---

### 工具2：官方API获取脚本

**文件：** `fetch_real_hongkong_stores.py`

**功能：**
1. 从Apple官方API获取门店列表
2. 自动提取香港门店
3. 可选验证门店有效性
4. 生成官方验证的配置文件

**使用方法：**
```bash
python3 fetch_real_hongkong_stores.py

# 自动流程：
# 1. 获取官方门店列表
# 2. 提取香港门店
# 3. 询问是否验证
# 4. 生成配置文件
```

---

## 📋 临时解决方案

### 在确认真实门店编号前

**选项A：暂时不使用香港门店**

修改配置文件，注释掉香港region：

```json
{
  // "region": "HK",  // 暂时禁用
  "region": "CN",
  "target_products": [...],
  "target_stores": [...]  // 使用大陆门店
}
```

**选项B：使用已验证的大陆门店**

香港用户可以监控深圳门店（距离较近）：

```json
{
  "region": "CN",
  "target_products": [...],
  "target_stores": [
    "R484",  // 深圳益田假日广场
    "R761",  // 深圳万象城
    "R793"   // 深圳前海壹方城
  ]
}
```

---

## 🔍 深入调查建议

### 方法1：使用浏览器实际测试

**步骤：**

1. 访问Apple香港官网：
   ```
   https://www.apple.com/hk/shop/buy-iphone
   ```

2. 选择iPhone型号和配置

3. 点击"查看店内提货情况"

4. 输入地址搜索门店

5. 打开开发者工具，查看Network面板

6. 找到pickup-message或fulfillment-messages请求

7. 查看请求参数中的store值

**这是最直接获取真实门店编号的方法！**

---

### 方法2：对比API端点

测试不同的API端点：

```bash
# 端点1：pickup-message
https://www.apple.com/hk/shop/retail/pickup-message

# 端点2：fulfillment-messages
https://www.apple.com/hk/shop/fulfillment-messages

# 端点3：store availability
https://www.apple.com/hk/shop/retail/store-availability
```

---

## ⚡ 快速行动步骤

### 立即可做（5分钟）

```bash
# 1. 运行官方API获取脚本
python3 fetch_real_hongkong_stores.py

# 2. 查看生成的配置
cat apple_stores_hongkong_official.json

# 3. 如果有有效门店，替换配置
cp apple_stores_hongkong_official.json apple_stores_hongkong.json
```

---

### 手动验证（10分钟）

1. 访问 https://www.apple.com/hk/retail/
2. 点击任意一家门店
3. 在该店页面选择"查看库存"
4. 打开F12开发者工具
5. 查看Network中的API请求
6. 记录实际的门店编号

---

### 完整扫描（15分钟）

```bash
python3 verify_hongkong_stores.py
# 选择 2 - 搜索实际有效的门店编号

# 等待扫描完成
# 查看结果文件
```

---

## 📊 预期结果

### 成功后

```
✅ 获取到真实的香港门店编号
✅ 所有门店API响应正常
✅ 可以正常监控香港门店库存
✅ 不会出现"监测不响应"的情况
```

### 配置文件示例

```json
{
  "region": "Hong Kong",
  "stores": [
    {
      "storeNumber": "实际编号",
      "storeName": "实际名称",
      "verified": true,
      "source": "Apple Official API"
    }
  ]
}
```

---

## 🎯 最终目标

### 确保

1. ✅ **所有门店编号都是真实有效的**
2. ✅ **API调用能正常响应**
3. ✅ **监控不会出现"无响应"**
4. ✅ **数据来源可靠（官方API）**

### 验证标准

```
测试命令：
python3 verify_hongkong_stores.py

期望结果：
✅ 有效门店: 4 个
❌ 无效门店: 0 个
📈 成功率: 100%
```

---

## 💡 建议

### 短期（今天）

1. **使用方案1** - 运行fetch_real_hongkong_stores.py
2. 查看是否能获取官方门店列表
3. 如果成功，使用官方数据
4. 如果失败，使用方案2手动验证

### 中期（本周）

1. 完成香港门店的完整验证
2. 更新apple_stores_hongkong.json
3. 测试增强版监控器
4. 确认可以正常监控

### 长期

1. 定期（每月）更新门店列表
2. 使用官方API自动更新
3. 建立门店变更检测机制

---

## 📞 使用工具

### 验证工具

```bash
# 验证现有配置
python3 verify_hongkong_stores.py

# 获取官方门店列表
python3 fetch_real_hongkong_stores.py

# 测试单个门店
python3 -c "from verify_hongkong_stores import test_store_api; print(test_store_api('R428', 'HK'))"
```

### 查看结果

```bash
# 查看验证报告
cat hongkong_stores_verification_*.json

# 查看官方API响应
cat store_list_api_response.json

# 查看生成的配置
cat apple_stores_hongkong_official.json
```

---

## ✅ 总结

### 当前状态

- ⚠️ 现有4个门店编号未能通过验证
- ⚠️ 可能是编号不正确或API参数问题
- ✅ 已提供2个验证工具
- ✅ 已提供3个解决方案

### 建议操作

1. **立即：** 运行 `fetch_real_hongkong_stores.py` 获取官方数据
2. **备选：** 手动访问Apple香港官网验证
3. **保险：** 暂时使用深圳门店作为替代

### 保证

使用官方API获取的门店编号可以100%保证：
- ✅ 编号准确
- ✅ API响应正常
- ✅ 监控有效
- ✅ 不会出现"不响应"情况

---

**报告生成时间：** 2025-10-06  
**验证工具：** verify_hongkong_stores.py, fetch_real_hongkong_stores.py  
**状态：** ⚠️ 需要验证和更新门店编号

**🔍 请运行验证工具获取准确的门店编号！**


